<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Press Scheduling Optimization Tool</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        textarea {
            width: 100%;
            height: 300px;
            margin-bottom: 20px;
            font-family: monospace;
            padding: 10px;
            border: 1px solid #ddd;
        }
        button {
            padding: 10px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        #optimizeBtn {
            background-color: #2196F3;
        }
        #clearBtn {
            background-color: #f44336;
        }
        #exportBtn {
            background-color: #ff9800;
        }
        .result {
            margin-top: 20px;
            border: 1px solid #ddd;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 4px;
        }
        h1, h2 {
            color: #333;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            padding: 8px;
            text-align: left;
            border: 1px solid #ddd;
        }
        th {
            background-color: #f2f2f2;
            position: sticky;
            top: 0;
        }
        .table-container {
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        .same-die {
            background-color: #d4edda;
        }
        .same-substrate {
            background-color: #d1ecf1;
        }
        .same-plates {
            background-color: #fff3cd;
        }
        .same-customer {
            background-color: #e8daef;
        }
        .single-color {
            border-left: 4px solid #4CAF50;
        }
        .four-color {
            border-left: 4px solid #2196F3;
        }
        .multi-color {
            border-left: 4px solid #FFC107;
        }
        .complex-color {
            border-left: 4px solid #F44336;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        .tab {
            padding: 10px 15px;
            cursor: pointer;
            margin-right: 5px;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 4px 4px 0 0;
        }
        .tab.active {
            background-color: white;
            font-weight: bold;
            border-bottom: 2px solid white;
            margin-bottom: -1px;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .stats {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card {
            flex: 1;
            min-width: 200px;
            padding: 15px;
            background-color: white;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
            color: #2196F3;
        }
        .positive {
            color: #4CAF50;
        }
        .negative {
            color: #f44336;
        }
        .legend {
            margin-bottom: 15px;
        }
        .legend-item {
            display: inline-block;
            padding: 5px 10px;
            margin-right: 10px;
            border-radius: 4px;
            margin-bottom: 5px;
        }
        .press-selector {
            margin-bottom: 15px;
        }
        #exportArea {
            display: none;
        }
        .parameters {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        label {
            margin-right: 15px;
            font-weight: bold;
        }
        input[type="number"] {
            width: 60px;
            padding: 5px;
            margin-right: 5px;
        }
        .urgent {
            background-color: #ffebee;
        }
        .approach-due {
            background-color: #fff8e1;
        }
        .ship-date {
            font-weight: bold;
        }
        .color-info {
            font-weight: bold;
        }
        .dot {
            height: 12px;
            width: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
        }
        .optimization-strategy {
            margin-top: 15px;
            padding: 10px;
            background-color: #e8f5e9;
            border-radius: 4px;
        }
        .strategy-option {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Press Scheduling Optimization Tool</h1>
        <p>Optimize label printing schedules to minimize changeovers while respecting ship dates.</p>

        <h2>Input Schedule Data</h2>
        <textarea id="inputData" placeholder="Paste your tab-delimited schedule data here..."></textarea>
        
        <div>
            <button id="analyzeBtn">Analyze Schedule Data</button>
            <button id="optimizeBtn" disabled>Optimize Schedule</button>
            <button id="exportBtn" disabled>Export Optimized Schedule</button>
            <button id="clearBtn">Clear Data</button>
        </div>

        <div class="parameters" id="optimizationParams" style="display: none;">
            <h2>Optimization Parameters</h2>
            <div>
                <label>Die Change Time (min): <input type="number" id="dieTime" value="15"></label>
                <label>Material Change Time (min): <input type="number" id="materialTime" value="10"></label>
                <label>Color Setup Time per Cylinder (min): <input type="number" id="colorTime" value="3"></label>
            </div>
            <div style="margin-top: 10px;">
                <label><input type="checkbox" id="prioritizeShipDates" checked> Prioritize ship dates</label>
                <label><input type="checkbox" id="groupByDie" checked> Group by Die ID</label>
                <label><input type="checkbox" id="groupByMaterial"> Group by Material</label>
                <label><input type="checkbox" id="groupByCustomer"> Group by Customer</label>
            </div>
            
            <div class="optimization-strategy">
                <h3>Primary Optimization Strategy</h3>
                <div class="strategy-option">
                    <label><input type="radio" name="optimStrategy" value="die" checked> Minimize Die Changes</label>
                    <p class="strategy-description">Focuses on reducing the number of die changes, which typically take the most time.</p>
                </div>
                <div class="strategy-option">
                    <label><input type="radio" name="optimStrategy" value="material"> Minimize Material Changes</label>
                    <p class="strategy-description">Prioritizes keeping the same substrate material to reduce waste and setup time.</p>
                </div>
                <div class="strategy-option">
                    <label><input type="radio" name="optimStrategy" value="customer"> Group by Customer</label>
                    <p class="strategy-description">Groups jobs from the same customer together to simplify logistics and delivery.</p>
                </div>
                <div class="strategy-option">
                    <label><input type="radio" name="optimStrategy" value="color"> Optimize Color Progression</label>
                    <p class="strategy-description">Arranges jobs to progress from simpler to more complex color setups.</p>
                </div>
            </div>
        </div>

        <div id="resultTabs" class="tabs" style="display: none;">
            <div class="tab active" data-tab="summary">Summary</div>
            <div class="tab" data-tab="original">Original Schedule</div>
            <div class="tab" data-tab="optimized">Optimized Schedule</div>
        </div>

        <div id="summaryTab" class="tab-content active">
            <div id="analysisSummary"></div>
        </div>

        <div id="originalTab" class="tab-content">
            <div class="press-selector">
                <label>Filter by Press: 
                    <select id="originalPressSelect">
                        <option value="all">All Presses</option>
                    </select>
                </label>
            </div>
            <div class="table-container">
                <table id="originalTable">
                    <thead>
                        <tr>
                            <th>Part #</th>
                            <th>Description</th>
                            <th>Customer</th>
                            <th>Due Date</th>
                            <th>Press</th>
                            <th>Die</th>
                            <th>Material</th>
                            <th>Colors</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <div id="optimizedTab" class="tab-content">
            <div class="press-selector">
                <label>Filter by Press: 
                    <select id="optimizedPressSelect">
                        <option value="all">All Presses</option>
                    </select>
                </label>
            </div>
            <div class="table-container">
                <table id="optimizedTable">
                    <thead>
                        <tr>
                            <th>Run Order</th>
                            <th>Part #</th>
                            <th>Description</th>
                            <th>Customer</th>
                            <th>Due Date</th>
                            <th>Press</th>
                            <th>Die</th>
                            <th>Material</th>
                            <th>Colors</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <textarea id="exportArea"></textarea>
    </div>

    <script>
        // DOM elements
        const inputDataEl = document.getElementById('inputData');
        const analyzeBtnEl = document.getElementById('analyzeBtn');
        const optimizeBtnEl = document.getElementById('optimizeBtn');
        const exportBtnEl = document.getElementById('exportBtn');
        const clearBtnEl = document.getElementById('clearBtn');
        const analysisSummaryEl = document.getElementById('analysisSummary');
        const optimizationParamsEl = document.getElementById('optimizationParams');
        const resultTabsEl = document.getElementById('resultTabs');
        const tabsEl = document.querySelectorAll('.tab');
        const tabContentEls = document.querySelectorAll('.tab-content');
        const originalTableEl = document.getElementById('originalTable').querySelector('tbody');
        const optimizedTableEl = document.getElementById('optimizedTable').querySelector('tbody');
        const exportAreaEl = document.getElementById('exportArea');
        const originalPressSelectEl = document.getElementById('originalPressSelect');
        const optimizedPressSelectEl = document.getElementById('optimizedPressSelect');
        
        // Parameter elements
        const dieTimeEl = document.getElementById('dieTime');
        const materialTimeEl = document.getElementById('materialTime');
        const colorTimeEl = document.getElementById('colorTime');
        const prioritizeShipDatesEl = document.getElementById('prioritizeShipDates');
        const groupByDieEl = document.getElementById('groupByDie');
        const groupByMaterialEl = document.getElementById('groupByMaterial');
        const groupByCustomerEl = document.getElementById('groupByCustomer');
        const optimStrategyEls = document.getElementsByName('optimStrategy');

        // Global variables
        let jobs = [];
        let optimizedJobs = [];
        let currentOriginalPress = "all";
        let currentOptimizedPress = "all";

        // Event listeners
        analyzeBtnEl.addEventListener('click', () => {
            analyzeData();
        });

        optimizeBtnEl.addEventListener('click', () => {
            optimizeData();
        });

        exportBtnEl.addEventListener('click', () => {
            exportOptimizedSchedule();
        });

        clearBtnEl.addEventListener('click', () => {
            clearData();
        });

        originalPressSelectEl.addEventListener('change', () => {
            currentOriginalPress = originalPressSelectEl.value;
            displayOriginalSchedule();
        });

        optimizedPressSelectEl.addEventListener('change', () => {
            currentOptimizedPress = optimizedPressSelectEl.value;
            displayOptimizedSchedule();
        });

        tabsEl.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.getAttribute('data-tab');
                
                // Update active tab
                tabsEl.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // Update visible content
                tabContentEls.forEach(content => content.classList.remove('active'));
                document.getElementById(tabId + 'Tab').classList.add('active');
            });
        });

        // Parse input data
        function parseInputData(data) {
            const lines = data.trim().split('\n');
            const parsed = [];
            
            for (let i = 0; i < lines.length; i++) {
                const fields = lines[i].split('\t');
                
                // Skip empty lines or incomplete data
                if (fields.length < 8) continue;
                
                const job = {
                    description: fields[0].trim(),
                    dueDate: fields[1].trim(),
                    runTime: fields[2].trim(),
                    setupTime: fields[3].trim(),
                    partNumber: fields[4].trim(),
                    shipDate: fields[5].trim(),
                    priority: fields[6].trim(),
                    status: fields[7].trim(),
                    customer: fields[8] ? fields[8].trim() : 'Unknown', // Add customer field
                    press: fields[9] ? fields[9].trim() : '',
                    die: fields[10] ? fields[10].trim() : '',
                    material: fields[11] ? fields[11].trim() : '',
                    colors: fields[12] ? parseInt(fields[12].trim()) : 1,
                    inStock: fields[13] ? fields[13].trim() === 'Yes' : false,
                    specialInstructions: fields[14] ? fields[14].trim() : '',
                };
                
                parsed.push(job);
            }
            
            return parsed;
        }

        // Analyze the input data
        function analyzeData() {
            const inputData = inputDataEl.value;
            if (!inputData.trim()) {
                alert('Please enter schedule data');
                return;
            }
            
            // Parse data
            jobs = parseInputData(inputData);
            
            if (jobs.length === 0) {
                alert('No valid jobs found in the input data. Please check the format.');
                return;
            }
            
            // Enable optimization button
            optimizeBtnEl.disabled = false;
            
            // Show optimization parameters
            optimizationParamsEl.style.display = 'block';
            
            // Update the original table
            updatePressOptions();
            displayOriginalSchedule();
            
            // Show results
            resultTabsEl.style.display = 'flex';
            
            // Create analysis summary
            createAnalysisSummary();
        }

        // Update press options in dropdowns
        function updatePressOptions() {
            // Get unique presses
            const presses = [...new Set(jobs.map(job => job.press))].filter(press => press);
            
            // Update both dropdowns
            [originalPressSelectEl, optimizedPressSelectEl].forEach(select => {
                // Clear existing options except the "All" option
                while (select.options.length > 1) {
                    select.remove(1);
                }
                
                // Add press options
                presses.forEach(press => {
                    const option = document.createElement('option');
                    option.value = press;
                    option.textContent = press;
                    select.appendChild(option);
                });
            });
        }

        // Create analysis summary
        function createAnalysisSummary() {
            const totalJobs = jobs.length;
            const dieChanges = countDieChanges(jobs);
            const materialChanges = countMaterialChanges(jobs);
            const colorAnalysis = analyzeColorComplexity(jobs);
            
            analysisSummaryEl.innerHTML = `
                <h2>Analysis Summary</h2>
                
                <div class="stats">
                    <div class="stat-card">
                        <h3>Total Jobs</h3>
                        <div class="stat-value">${totalJobs}</div>
                    </div>
                    <div class="stat-card">
                        <h3>Die Changes</h3>
                        <div class="stat-value">${dieChanges}</div>
                    </div>
                    <div class="stat-card">
                        <h3>Material Changes</h3>
                        <div class="stat-value">${materialChanges}</div>
                    </div>
                    <div class="stat-card">
                        <h3>Jobs with Dies</h3>
                        <div class="stat-value">${jobs.filter(job => job.die).length}</div>
                    </div>
                </div>
                
                <h2>Changeover Time Analysis</h2>
                <p>Based on your parameters:</p>
                <ul>
                    <li>Die changes (${dieChanges} × ${dieTimeEl.value} min) = ${dieChanges * dieTimeEl.value} minutes</li>
                    <li>Material changes (${materialChanges} × ${materialTimeEl.value} min) = ${materialChanges * materialTimeEl.value} minutes</li>
                </ul>
                <p>Total changeover time: ${calculateTotalChangeoverTime(jobs)} minutes (${Math.floor(calculateTotalChangeoverTime(jobs) / 60)} hours and ${calculateTotalChangeoverTime(jobs) % 60} minutes)</p>
                
                <h2>Color Complexity Analysis</h2>
                <ul>
                    <li>Single Color Jobs: ${colorAnalysis.singleColor} (${Math.round(colorAnalysis.singleColor / totalJobs * 100)}%)</li>
                    <li>4-Color Process Jobs: ${colorAnalysis.fourColor} (${Math.round(colorAnalysis.fourColor / totalJobs * 100)}%)</li>
                    <li>Other Multi-Color Jobs: ${colorAnalysis.multiColor} (${Math.round(colorAnalysis.multiColor / totalJobs * 100)}%)</li>
                    <li>Complex Color Jobs (5+ colors): ${colorAnalysis.complexColor} (${Math.round(colorAnalysis.complexColor / totalJobs * 100)}%)</li>
                </ul>
                
                <h2>Press Distribution</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Press</th>
                            <th>Jobs</th>
                            <th>Die Changes</th>
                            <th>Material Changes</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${createPressDistributionRows(jobs)}
                    </tbody>
                </table>
                
                <h2>Customer Distribution</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Customer</th>
                            <th>Jobs</th>
                            <th>Earliest Due Date</th>
                            <th>Latest Due Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${createCustomerDistributionRows(jobs)}
                    </tbody>
                </table>
            `;
        }

        // Create press distribution table rows
        function createPressDistributionRows(jobs) {
            const pressCounts = {};
            
            // Group jobs by press
            jobs.forEach(job => {
                const press = job.press || 'Unassigned';
                if (!pressCounts[press]) {
                    pressCounts[press] = {
                        jobs: 0,
                        dies: new Set(),
                        materials: new Set()
                    };
                }
                
                pressCounts[press].jobs++;
                if (job.die) pressCounts[press].dies.add(job.die);
                if (job.material) pressCounts[press].materials.add(job.material);
            });
            
            // Calculate changes for each press
            const pressRows = Object.keys(pressCounts).map(press => {
                const pressJobs = jobs.filter(job => (job.press || 'Unassigned') === press);
                const dieChanges = countDieChanges(pressJobs);
                const materialChanges = countMaterialChanges(pressJobs);
                
                return `
                    <tr>
                        <td>${press}</td>
                        <td>${pressCounts[press].jobs}</td>
                        <td>${dieChanges}</td>
                        <td>${materialChanges}</td>
                    </tr>
                `;
            });
            
            return pressRows.join('');
        }

        // Create customer distribution table rows
        function createCustomerDistributionRows(jobs) {
            const customerCounts = {};
            
            // Group jobs by customer
            jobs.forEach(job => {
                const customer = job.customer || 'Unknown';
                if (!customerCounts[customer]) {
                    customerCounts[customer] = {
                        jobs: 0,
                        dueDates: []
                    };
                }
                
                customerCounts[customer].jobs++;
                if (job.shipDate) customerCounts[customer].dueDates.push(new Date(job.shipDate));
            });
            
            // Create rows for each customer
            const customerRows = Object.keys(customerCounts).map(customer => {
                const dueDates = customerCounts[customer].dueDates;
                let earliestDate = dueDates.length ? new Date(Math.min(...dueDates)) : '-';
                let latestDate = dueDates.length ? new Date(Math.max(...dueDates)) : '-';
                
                // Format dates
                if (earliestDate !== '-') {
                    earliestDate = earliestDate.toLocaleDateString();
                }
                if (latestDate !== '-') {
                    latestDate = latestDate.toLocaleDateString();
                }
                
                return `
                    <tr>
                        <td>${customer}</td>
                        <td>${customerCounts[customer].jobs}</td>
                        <td>${earliestDate}</td>
                        <td>${latestDate}</td>
                    </tr>
                `;
            });
            
            return customerRows.join('');
        }

        // Display original schedule
        function displayOriginalSchedule() {
            originalTableEl.innerHTML = '';
            
            // Filter jobs by selected press
            let displayJobs;
            if (currentOriginalPress === "all") {
                displayJobs = jobs;
            } else {
                displayJobs = jobs.filter(job => job.press === currentOriginalPress);
            }
            
            // Sort jobs by due date
            displayJobs.sort((a, b) => {
                const dateA = new Date(a.shipDate);
                const dateB = new Date(b.shipDate);
                return dateA - dateB;
            });
            
            // Display jobs
            displayJobs.forEach(job => {
                const row = document.createElement('tr');
                
                // Apply row classes for special highlighting
                if (job.priority === 'Urgent') {
                    row.classList.add('urgent');
                } else if (job.priority === 'High') {
                    row.classList.add('approach-due');
                }
                
                // Apply color complexity class
                const colorClass = getColorClass(job.colors);
                if (colorClass) {
                    row.classList.add(colorClass);
                }
                
                row.innerHTML = `
                    <td>${job.partNumber}</td>
                    <td>${job.description}</td>
                    <td>${job.customer || 'Unknown'}</td>
                    <td class="ship-date">${job.shipDate}</td>
                    <td>${job.press || ''}</td>
                    <td>${job.die || ''}</td>
                    <td>${job.material || ''}</td>
                    <td class="color-info">${job.colors || '-'}</td>
                    <td>${job.status}</td>
                `;
                
                originalTableEl.appendChild(row);
            });
        }

        // Optimize the schedule
        function optimizeData() {
            // Get optimization parameters
            const dieTime = parseInt(dieTimeEl.value);
            const materialTime = parseInt(materialTimeEl.value);
            const colorTime = parseInt(colorTimeEl.value);
            const prioritizeShipDates = prioritizeShipDatesEl.checked;
            const groupByDie = groupByDieEl.checked;
            const groupByMaterial = groupByMaterialEl.checked;
            const groupByCustomer = groupByCustomerEl.checked;
            
            // Get primary optimization strategy
            let optimStrategy = '';
            for (const radio of optimStrategyEls) {
                if (radio.checked) {
                    optimStrategy = radio.value;
                    break;
                }
            }
            
            // Clone jobs array to avoid modifying original
            const jobsCopy = JSON.parse(JSON.stringify(jobs));
            
            // Perform optimization
            optimizedJobs = optimizeSchedule(jobsCopy, {
                dieTime,
                materialTime,
                colorTime,
                prioritizeShipDates,
                groupByDie,
                groupByMaterial,
                groupByCustomer,
                optimStrategy
            });
            
            // Update the optimized table
            displayOptimizedSchedule();
            
            // Show the optimized tab
            tabsEl.forEach(tab => tab.classList.remove('active'));
            tabContentEls.forEach(content => content.classList.remove('active'));
            document.querySelector('.tab[data-tab="optimized"]').classList.add('active');
            document.getElementById('optimizedTab').classList.add('active');
            
            // Enable export button
            exportBtnEl.disabled = false;
            
            // Create stats summary comparing original vs optimized
            createStatsSummary(jobs, optimizedJobs);
        }

        // Optimize schedule based on parameters
        function optimizeSchedule(jobs, params) {
            // Sort jobs by ship date first if prioritizing ship dates
            if (params.prioritizeShipDates) {
                jobs.sort((a, b) => {
                    const dateA = new Date(a.shipDate);
                    const dateB = new Date(b.shipDate);
                    return dateA - dateB;
                });
            }
            
            // Group jobs by press
            const pressBuckets = {};
            jobs.forEach(job => {
                const press = job.press || 'Unassigned';
                if (!pressBuckets[press]) {
                    pressBuckets[press] = [];
                }
                pressBuckets[press].push(job);
            });
            
            // Optimize each press bucket separately
            const optimizedJobs = [];
            for (const press in pressBuckets) {
                const pressJobs = pressBuckets[press];
                
                // Apply the selected optimization strategy
                switch (params.optimStrategy) {
                    case 'die':
                        optimizedJobs.push(...optimizeByDie(pressJobs, params));
                        break;
                    case 'material':
                        optimizedJobs.push(...optimizeByMaterial(pressJobs, params));
                        break;
                    case 'customer':
                        optimizedJobs.push(...optimizeByCustomer(pressJobs, params));
                        break;
                    case 'color':
                        optimizedJobs.push(...optimizeByColorProgression(pressJobs, params));
                        break;
                    default:
                        optimizedJobs.push(...optimizeByDie(pressJobs, params));
                }
            }
            
            // Add run order to jobs
            optimizedJobs.forEach((job, index) => {
                job.runOrder = index + 1;
            });
            
            return optimizedJobs;
        }

        // Optimize by minimizing die changes
        function optimizeByDie(jobs, params) {
            // Group jobs by die
            const dieGroups = {};
            jobs.forEach(job => {
                const dieId = job.die || 'No Die';
                if (!dieGroups[dieId]) {
                    dieGroups[dieId] = [];
                }
                dieGroups[dieId].push(job);
            });
            
            // Sort each die group by ship date
            if (params.prioritizeShipDates) {
                for (const dieId in dieGroups) {
                    dieGroups[dieId].sort((a, b) => {
                        const dateA = new Date(a.shipDate);
                        const dateB = new Date(b.shipDate);
                        return dateA - dateB;
                    });
                }
            }
            
            // If grouping by material within die groups
            if (params.groupByMaterial) {
                for (const dieId in dieGroups) {
                    dieGroups[dieId] = groupJobsByMaterial(dieGroups[dieId], params);
                }
            }
            
            // Optimize the order of die groups based on earliest ship date
            const sortedDieIds = Object.keys(dieGroups).sort((a, b) => {
                const earliestDateA = getEarliestShipDate
